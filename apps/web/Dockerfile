FROM node:18-alpine

# Set working directory
WORKDIR /app

# Copy dependencies
COPY package* ./

# Install dependencies 
RUN npm install

# Copy the code
COPY . .

# Env
ARG NEXT_PUBLIC_NODE_ENV
ARG NEXT_PUBLIC_URL_SNAPSHOT_HANDLER
ARG NEXT_PUBLIC_URL_BABYBOX_SERVICE
ARG NEXT_PUBLIC_URL_USER_SERVICE
ARG NEXT_PUBLIC_URL_NOTIFICATION_SERVICE
ARG NEXT_PUBLIC_URL_BATTERY_ANALYZER

ENV NEXT_PUBLIC_NODE_ENV=${NEXT_PUBLIC_NODE_ENV}
ENV NEXT_PUBLIC_URL_SNAPSHOT_HANDLER=${NEXT_PUBLIC_URL_SNAPSHOT_HANDLER}
ENV NEXT_PUBLIC_URL_BABYBOX_SERVICE=${NEXT_PUBLIC_URL_BABYBOX_SERVICE}
ENV NEXT_PUBLIC_URL_USER_SERVICE=${NEXT_PUBLIC_URL_USER_SERVICE}
ENV NEXT_PUBLIC_URL_NOTIFICATION_SERVICE=${NEXT_PUBLIC_URL_NOTIFICATION_SERVICE}
ENV NEXT_PUBLIC_URL_BATTERY_ANALYZER=${NEXT_PUBLIC_URL_BATTERY_ANALYZER}


# Build for production 
RUN npm run build

# Expose the port 
EXPOSE 3000

# Start the production server
CMD ["npm", "run", "start"]

